# overhand_knot.yml (updated for includes + params)

include:
  - "base/defaults.yml"
  - "base/wafer_presets.yml"
  - "base/curve_presents.yml"

params:
  project_name: "Test Overhand Knot"
  version: "1.0"
  created: "2025-07-27"

  # Output location + filenames
  out_dir: "/home/don/Documents/Temp/FreeCAD/"
  cuts_file: "cutting_list_overhand_knot.txt"
  place_file: "placement_list_overhand_knot.txt"
  trace_file: "build_trace.log"

  # Common geometry parameters
  cylinder_diameter: 2.0
  knot_scale: 1.5
  knot_points: 300
  knot_increment: 1.0
  knot_start_fraction: 0.0
  knot_end_fraction: 0.9

  # Wafer quality controls
  wafer_min_height: 0.5
  wafer_max_chord: 0.2

metadata:
  project_name: "${project_name}"
  version: "${version}"
  created: "${created}"
  description: "Test Overhand Knot (includes + params)"

# Only override what differs from base/defaults.yml
output_files:
  working_directory: "${out_dir}"
  cuts_file: "${cuts_file}"
  place_file: "${place_file}"
  trace_file: "${trace_file}"

workflow:
  - operation: "remove_objects"
    description: "Clean up any existing objects"
    keep_patterns:
      - "helix.*"

  - operation: "build_segment"
    segment_type: "curve_follower"
    name: "overhand_knot"
    curve_spec:
      type: "overhand_knot"
      parameters:
        scale: "${knot_scale}"
        points: "${knot_points}"
        increment: "${knot_increment}"
      segment:
        start_fraction: "${knot_start_fraction}"
        end_fraction: "${knot_end_fraction}"
      transformations:
        - operation: "scale"
          factor: "${knot_scale}"
        - operation: "rotate"
          axis: "x"
          angle: 0
    wafer_settings:
      cylinder_diameter: "${cylinder_diameter}"
      min_height: "${wafer_min_height}"
      max_chord: "${wafer_max_chord}"
    segment_settings:
      show_lcs: false
      build_segment: true
      rotate_segment: 0.0
      add_curve_vertices: true

  - operation: "build_segment"
    segment_type: "curve_follower"
    name: "overhand_knot2"
    curve_spec:
      type: "overhand_knot"
      parameters:
        scale: "${knot_scale}"
        points: "${knot_points}"
        increment: "${knot_increment}"
      segment:
        start_fraction: "${knot_start_fraction}"
        end_fraction: "${knot_end_fraction}"
      transformations:
        - operation: "scale"
          factor: "${knot_scale}"
        - operation: "rotate"
          axis: "x"
          angle: 0
    wafer_settings:
      cylinder_diameter: "${cylinder_diameter}"
      min_height: "${wafer_min_height}"
      max_chord: "${wafer_max_chord}"
    segment_settings:
      show_lcs: false
      build_segment: true
      rotate_segment: 180.0
      add_curve_vertices: true
